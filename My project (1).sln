using System;
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;

public class Player : MonoBehaviour
{
#region Inputs    
    [SerializeField] private Rigidbody2D rb;
    [SerializeField] public Animator player;
    [SerializeField] Vector2 lastPosition;
    [SerializeField] public Text Texts;
    [SerializeField] private float speed = 4;
    [SerializeField] private float jumpForce = 5f;
    [SerializeField] bool player1;   
    private bool onGround=true;
    private int player1C=0;
    private int player2C=0;
#endregion

#region PlayerCollision
     void OnCollisionEnter2D(Collision2D col) 
    {
        if (col.gameObject.tag=="Teren") onGround=true; 
    }

    private  void OnCollisionExit2D(Collision2D col2)
    {
        if (col2.gameObject.tag=="Teren") onGround=false;
    }
#endregion

#region Init   
    void Start()
    {
        rb = GetComponent<Rigidbody2D>();
        if(transform.name=="Ghost1")
            player1=true;
            else
            player1=false; 
        Texts.text = player1C.ToString()+" : "+player2C.ToString();    
    }
#endregion

private void FixedUpdate() {
#region global
            
        if (Input.GetAxisRaw("Vertical")==0)
        {   
            player.SetFloat("Movement",Vector2.Distance((Vector2)transform.position,lastPosition)/Time.fixedDeltaTime);
            lastPosition=transform.position;
        }

#endregion
}
    private void Update()
    {
#region Player1Input
        if (player1)
        {
            if (Input.GetKey(KeyCode.S)) player.SetBool("SpacePressed",true);
            else player.SetBool("SpacePressed",false);
            if ((Input.GetKeyDown(KeyCode.W)) && onGround==true)
            {
                Debug.Log("Executed1");
                rb.AddForce((Vector2.up*jumpForce*Time.fixedDeltaTime),ForceMode2D.Force);
            }
            if (Input.GetKey(KeyCode.A))
            {
                rb.velocity=transform.right*-1*speed;
                transform.localScale=new Vector2(-0.4f,0.4f);
            }
            else if(Input.GetKey(KeyCode.D))
            {
                rb.velocity=transform.right*speed;
                transform.localScale=new Vector2(0.4f,0.4f);
            }
        }   
#endregion

#region Player2Input
    if (!player1)
    {
        if (Input.GetKey(KeyCode.DownArrow)) player.SetBool("spacePressed2",true);
        else player.SetBool("spacePressed2",false);
        if ((Input.GetKeyDown(KeyCode.UpArrow)) && onGround==true)
        {
            Debug.Log("Executed");
            rb.AddForce(Vector2.up*jumpForce*Time.fixedDeltaTime,ForceMode2D.Force);
        }
        if (Input.GetKey(KeyCode.LeftArrow))
        {
            rb.velocity=transform.right*-1*speed;
            transform.localScale=new Vector2(-0.4f,0.4f);
        }
        else if(Input.GetKey(KeyCode.RightArrow))
        {
            rb.velocity=transform.right*speed;
            transform.localScale=new Vector2(0.4f,0.4f);
        }
        }
#endregion
    }
}
